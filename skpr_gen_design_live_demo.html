<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.2.335">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="dcterms.date" content="2023-02-21">

<title>Design of Experiments in R with skpr - gen_design_basics</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">Design of Experiments in R with skpr</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html">
 <span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./R_basics_tutorial.html">
 <span class="menu-text">R Basics Tutorial</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./skpr_gen_design_live_demo.html" aria-current="page">
 <span class="menu-text">Generating Optimal Designs with skpr</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./skpr_eval_design_live_demo.html">
 <span class="menu-text">Evaluating Experimental Designs with skpr</span></a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#load-our-libraries" id="toc-load-our-libraries" class="nav-link active" data-scroll-target="#load-our-libraries">Load our libraries</a></li>
  <li><a href="#creating-the-candidate-set-and-the-constrained-candidate-set" id="toc-creating-the-candidate-set-and-the-constrained-candidate-set" class="nav-link" data-scroll-target="#creating-the-candidate-set-and-the-constrained-candidate-set">Creating the candidate set and the constrained candidate set</a></li>
  <li><a href="#generating-our-first-design-with-the-unconstrained-candidate-set-to-see-the-classical-design" id="toc-generating-our-first-design-with-the-unconstrained-candidate-set-to-see-the-classical-design" class="nav-link" data-scroll-target="#generating-our-first-design-with-the-unconstrained-candidate-set-to-see-the-classical-design">Generating our first design with the unconstrained candidate set to see the classical design</a></li>
  <li><a href="#design-generation-with-a-constrained-candidate-set" id="toc-design-generation-with-a-constrained-candidate-set" class="nav-link" data-scroll-target="#design-generation-with-a-constrained-candidate-set">Design generation with a constrained candidate set</a></li>
  <li><a href="#generating-designs-that-can-detect-curvature" id="toc-generating-designs-that-can-detect-curvature" class="nav-link" data-scroll-target="#generating-designs-that-can-detect-curvature">Generating designs that can detect curvature</a></li>
  <li><a href="#filling-the-design-space" id="toc-filling-the-design-space" class="nav-link" data-scroll-target="#filling-the-design-space">Filling the design space</a></li>
  <li><a href="#i-optimality" id="toc-i-optimality" class="nav-link" data-scroll-target="#i-optimality">I-Optimality</a></li>
  <li><a href="#comparing-d-and-i-optimal-designs-with-fraction-of-design-space-plots" id="toc-comparing-d-and-i-optimal-designs-with-fraction-of-design-space-plots" class="nav-link" data-scroll-target="#comparing-d-and-i-optimal-designs-with-fraction-of-design-space-plots">Comparing D and I optimal designs with Fraction of Design Space plots</a></li>
  <li><a href="#split-plot-designs" id="toc-split-plot-designs" class="nav-link" data-scroll-target="#split-plot-designs">Split-plot designs</a></li>
  <li><a href="#design-augmentation" id="toc-design-augmentation" class="nav-link" data-scroll-target="#design-augmentation">Design augmentation</a></li>
  <li><a href="#statistical-power" id="toc-statistical-power" class="nav-link" data-scroll-target="#statistical-power">Statistical Power</a></li>
  <li><a href="#saving-design-to-csv-to-share" id="toc-saving-design-to-csv-to-share" class="nav-link" data-scroll-target="#saving-design-to-csv-to-share">Saving design to CSV to share</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">gen_design_basics</h1>
</div>



<div class="quarto-title-meta">

    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">February 21, 2023</p>
    </div>
  </div>
  
    
  </div>
  

</header>

<section id="load-our-libraries" class="level1">
<h1>Load our libraries</h1>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-1_ab918cdb8c016c39bef9a0589d428122">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(skpr)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="creating-the-candidate-set-and-the-constrained-candidate-set" class="level1">
<h1>Creating the candidate set and the constrained candidate set</h1>
<p>We want to run a test on a synthetic aperture radar attached to an aircraft. We want to characterize how the resolution of the collected imagery changes depending on the speed, altitude, and mode of the radar.</p>
<p>We first want to generate our flight envelope. We do this by generating a table (data.frame) of all combinations of our input factors with <code>expand.grid()</code>, and then filtering out all those that don’t match our constraints.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-2_6d91da54fd078f30107aeb66a88f4d2d">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Small example of what expand.grid() outputs</span></span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">expand.grid</span>(<span class="at">altitude    =</span> <span class="fu">seq</span>(<span class="dv">10000</span>,<span class="dv">30000</span>,<span class="at">by=</span><span class="dv">10000</span>),</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">speed       =</span> <span class="fu">seq</span>(<span class="dv">450</span>,<span class="dv">550</span>,<span class="at">by=</span><span class="dv">50</span>),</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mode        =</span> <span class="fu">c</span>(<span class="st">"scan"</span>, <span class="st">"strip"</span>, <span class="st">"spotlight"</span>),</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">target_env  =</span> <span class="fu">c</span>(<span class="st">"urban"</span>, <span class="st">"desert"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   altitude speed      mode target_env
1     10000   450      scan      urban
2     20000   450      scan      urban
3     30000   450      scan      urban
4     10000   500      scan      urban
5     20000   500      scan      urban
6     30000   500      scan      urban
7     10000   550      scan      urban
8     20000   550      scan      urban
9     30000   550      scan      urban
10    10000   450     strip      urban
11    20000   450     strip      urban
12    30000   450     strip      urban
13    10000   500     strip      urban
14    20000   500     strip      urban
15    30000   500     strip      urban
16    10000   550     strip      urban
17    20000   550     strip      urban
18    30000   550     strip      urban
19    10000   450 spotlight      urban
20    20000   450 spotlight      urban
21    30000   450 spotlight      urban
22    10000   500 spotlight      urban
23    20000   500 spotlight      urban
24    30000   500 spotlight      urban
25    10000   550 spotlight      urban
26    20000   550 spotlight      urban
27    30000   550 spotlight      urban
28    10000   450      scan     desert
29    20000   450      scan     desert
30    30000   450      scan     desert
31    10000   500      scan     desert
32    20000   500      scan     desert
33    30000   500      scan     desert
34    10000   550      scan     desert
35    20000   550      scan     desert
36    30000   550      scan     desert
37    10000   450     strip     desert
38    20000   450     strip     desert
39    30000   450     strip     desert
40    10000   500     strip     desert
41    20000   500     strip     desert
42    30000   500     strip     desert
43    10000   550     strip     desert
44    20000   550     strip     desert
45    30000   550     strip     desert
46    10000   450 spotlight     desert
47    20000   450 spotlight     desert
48    30000   450 spotlight     desert
49    10000   500 spotlight     desert
50    20000   500 spotlight     desert
51    30000   500 spotlight     desert
52    10000   550 spotlight     desert
53    20000   550 spotlight     desert
54    30000   550 spotlight     desert</code></pre>
</div>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>candidate_set <span class="ot">=</span> <span class="fu">expand.grid</span>(<span class="at">altitude    =</span> <span class="fu">seq</span>(<span class="dv">10000</span>,<span class="dv">30000</span>,<span class="at">by=</span><span class="dv">1000</span>),</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>                            <span class="at">speed       =</span> <span class="fu">seq</span>(<span class="dv">450</span>,<span class="dv">550</span>,<span class="at">by=</span><span class="dv">5</span>),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>                            <span class="at">mode        =</span> <span class="fu">c</span>(<span class="st">"scan"</span>, <span class="st">"strip"</span>, <span class="st">"spotlight"</span>),</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>                            <span class="at">target_env  =</span> <span class="fu">c</span>(<span class="st">"urban"</span>, <span class="st">"desert"</span>))</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">nrow</span>(candidate_set)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 2646</code></pre>
</div>
</div>
</section>
<section id="generating-our-first-design-with-the-unconstrained-candidate-set-to-see-the-classical-design" class="level1">
<h1>Generating our first design with the unconstrained candidate set to see the classical design</h1>
<p>First we’ll generate a design using the full linear model with all interactions. Our first test design will have 24 runs.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-3_ff540b1c5649c19bb19bd1ea68a44c24">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>flight_design_no_constraints <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> candidate_set,</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span>(altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">24</span>,</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">randomized =</span> <span class="cn">FALSE</span>) </span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>flight_design_no_constraints</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   altitude speed      mode
1     10000   450      scan
2     10000   450      scan
3     10000   450     strip
4     10000   450     strip
5     10000   450 spotlight
6     10000   450 spotlight
7     10000   550      scan
8     10000   550      scan
9     10000   550     strip
10    10000   550     strip
11    10000   550 spotlight
12    10000   550 spotlight
13    30000   450      scan
14    30000   450      scan
15    30000   450     strip
16    30000   450     strip
17    30000   450 spotlight
18    30000   450 spotlight
19    30000   550      scan
20    30000   550      scan
21    30000   550     strip
22    30000   550     strip
23    30000   550 spotlight
24    30000   550 spotlight</code></pre>
</div>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_no_constraints)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    D        I   A            G   T  E Alias
1 100 0.212963 100 Not Computed 240 24     9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_no_constraints) <span class="sc">+</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Note that randomization doesn’t affect the design–it simply rearranges it so it’s easier to read. The order of the design doesn’t affect the design metrics in any way. However, the tester should randomize the runs when the test is executed.</p>
<p>This generated the classical experimental design for this candidate set: test points at the corners of the space.</p>
</section>
<section id="design-generation-with-a-constrained-candidate-set" class="level1">
<h1>Design generation with a constrained candidate set</h1>
<p>Now let’s see what design points are selected when we constrain our candidate set to the allowable flight envelope.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-4_5b43967c88bb0d0a0aa7662866550302">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>constrained_candidate_set <span class="ot">=</span> candidate_set <span class="sc">|&gt;</span> </span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="dv">70000</span> <span class="sc">-</span> speed <span class="sc">*</span> <span class="dv">90</span> <span class="sc">&gt;</span> altitude) <span class="sc">|&gt;</span> </span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">-</span><span class="dv">430000</span> <span class="sc">+</span> speed <span class="sc">*</span> <span class="dv">1000</span> <span class="sc">&gt;</span> altitude) <span class="sc">|&gt;</span> </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="dv">150000</span> <span class="sc">-</span> speed <span class="sc">*</span> <span class="dv">300</span> <span class="sc">&lt;</span> altitude)  <span class="sc">|&gt;</span> </span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="sc">-</span><span class="dv">14000</span> <span class="sc">+</span> speed <span class="sc">*</span> <span class="dv">50</span> <span class="sc">&lt;</span> altitude)</span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a><span class="co">#Plot the new constrained candidate set</span></span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>constrained_candidate_set) <span class="sc">+</span></span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude))  <span class="sc">+</span></span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="sc">-</span><span class="dv">90</span>, <span class="at">intercept=</span><span class="dv">70000</span>,<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">1000</span>, <span class="at">intercept=</span><span class="sc">-</span><span class="dv">430000</span>,<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="sc">-</span><span class="dv">300</span>, <span class="at">intercept=</span><span class="dv">150000</span>,<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">slope =</span> <span class="dv">50</span>, <span class="at">intercept=</span><span class="sc">-</span><span class="dv">14000</span>,<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Testing Flight Envelope"</span>) <span class="sc">+</span></span>
<span id="cb11-15"><a href="#cb11-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>flight_design <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span>,</span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">24</span>,</span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">randomized=</span><span class="cn">FALSE</span>) </span>
<span id="cb12-6"><a href="#cb12-6" aria-hidden="true" tabindex="-1"></a>flight_design</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   altitude speed      mode
1     10000   470      scan
2     10000   470      scan
3     10000   470     strip
4     10000   470     strip
5     10000   470 spotlight
6     10000   470 spotlight
7     14000   550      scan
8     14000   550      scan
9     14000   550     strip
10    14000   550     strip
11    14000   550 spotlight
12    14000   550 spotlight
13    20000   550      scan
14    20000   550      scan
15    20000   550     strip
16    20000   550     strip
17    20000   550 spotlight
18    20000   550 spotlight
19    28000   460      scan
20    28000   460      scan
21    28000   460     strip
22    28000   460     strip
23    28000   460 spotlight
24    28000   460 spotlight</code></pre>
</div>
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         D         I        A            G        T        E Alias
1 62.33936 0.3402056 44.99871 Not Computed 175.7037 2.453013     9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design) <span class="sc">+</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-4-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see we are now selecting the “corners” of our flight envelope.</p>
</section>
<section id="generating-designs-that-can-detect-curvature" class="level1">
<h1>Generating designs that can detect curvature</h1>
<p>Let’s say we suspect that the behavior of the NIIRS rating may not be linear–for example, we might suspect that at low altitudes we may have poor resolution due to shadowing effects, while at high altitudes the distance may negatively impact resolution, and we want to detect the sweet spot in-between. This means we want to be able to detect “curvature,” which we specify in an R formula with the “as.is” function, <code>I()</code>. This function evaluates the expression contained within rather than interpreting it as part of the formula. For example, the formula expression <code>~(x+y)^2</code> is interpreted by R as fitting a main effects model with interactions between <code>x</code> and <code>y</code> <code>~x + y + x:y</code>, while <code>~I((x+y)^2)</code> is interpreted as fitting a new column of value <code>(x+y)^2</code>. This function is just shorthand for adding a new column to your data.frame (e.g.&nbsp;<code>design$x_squared = design$x * design$x</code>) with the arithmetic value computed within.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-5_3f3e21b7b8968a033d4b584bdcb83df9">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a>flight_design_quadratic <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">24</span>) </span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_quadratic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         D         I       A            G        T         E Alias
1 42.11373 0.5627597 18.5322 Not Computed 187.1708 0.7093834     9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_quadratic) <span class="sc">+</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>We see we now have center points long with points on the extrema: these points allow us to determine if the relationship is linear or has curvature.</p>
</section>
<section id="filling-the-design-space" class="level1">
<h1>Filling the design space</h1>
<p>However, you might note that This appears to be only partially filling up the design space–one indication that your design could be improved is if there is a lack of balance. Let’s increase the number of runs and see where the additional test points end up.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-6_476494f5b6e1927a77002c511d01cdd2">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a>flight_design_quadratic2 <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">72</span>) </span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-6"><a href="#cb20-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-7"><a href="#cb20-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_quadratic2) <span class="sc">+</span></span>
<span id="cb20-8"><a href="#cb20-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb20-9"><a href="#cb20-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb20-10"><a href="#cb20-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb20-11"><a href="#cb20-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-6-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now the three factors are fairly well balanced. When a design is well-balanced and adding more points results only in replicating additional test points, you can at least be assured that you are covering the space well (although those replicates might be required to have sufficient power to answer your hypothesis, depending on your effect size).</p>
<p>However, we should only expect balance between factors when the design space is balanced: disallowed combinations can actually make it so the optimal design also isn’t balanced. We can add a constraint to one of the modes to see how it results in the design losing symmetry across modes.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-7_a8f754ace3b23e51218d0748019aea6c">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>constrained_candidate_set2 <span class="ot">=</span> <span class="fu">filter</span>(constrained_candidate_set, mode <span class="sc">!=</span> <span class="st">"spotlight"</span> <span class="sc">|</span> altitude <span class="sc">&lt;</span> <span class="dv">25000</span>)</span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>flight_design_quadratic3 <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set2, </span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">trials =</span> <span class="dv">72</span>) </span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_quadratic3) <span class="sc">+</span></span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set2, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-7-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="i-optimality" class="level1">
<h1>I-Optimality</h1>
<p>Let’s say we’re more interested in predicting how the NIIRS value varies across the space, rather than just estimating the size of the effects from each model term. Here, we will want to use something called an I-optimal design, which minimizes the average prediction variance across the space.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-8_9eb51c6a074f7d10cd4d90552a61ea7e">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a>flight_design_prediction <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb22-4"><a href="#cb22-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">72</span>,</span>
<span id="cb22-5"><a href="#cb22-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">optimality =</span> <span class="st">"I"</span>) </span>
<span id="cb22-6"><a href="#cb22-6" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_prediction)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         D         I        A            G        T        E Alias
1 39.75236 0.1515717 24.90418 Not Computed 476.1945 3.999816     9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Compare it to the previous design</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_quadratic2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         D         I        A            G        T        E Alias
1 42.82161 0.1747125 20.54451 Not Computed 554.1562 2.570192     9</code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co">#D-optimal design</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_quadratic2) <span class="sc">+</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co">#I-optimal design</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_prediction) <span class="sc">+</span></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-8-2.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>However, these optimality criteria don’t tell us much, other than we found a design that’s better in one criteria than the other. A design can be mathematically optimal for a given design criterion and specified number of runs but still be inadequate for the actual experimental goal(s). We need other ways to evaluate the designs to decide which one to choose.</p>
</section>
<section id="comparing-d-and-i-optimal-designs-with-fraction-of-design-space-plots" class="level1">
<h1>Comparing D and I optimal designs with Fraction of Design Space plots</h1>
<p>Ideally, a design would have low prediction variance across the entire design space. We can use a visualization called a Fraction of Design Space (FDS) plot to help choose between designs if this is the primary metric we are interested in. A FDS Plot shows the proportion of the design space over which the relative prediction variance lies below a given value. For a hypothetical ideal design, this graph would be a flat horizontal line: this means you would have the same prediction variance everywhere. Realistically, the prediction variance will always vary across the design space, as we only have a finite number of test points to allocate. When comparing designs using FDS plots we can assess designs by how much of the design space is under a particular prediction variance value as well as what the worst case scenario for prediction variance is. I-optimal designs are specifically designed for prediction, so let’s see how an I-optimal design compares to a D-optimal using an FDS plot.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-9_32ecd7eff44274ef7d03b1ad47042477">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_fds</span>(flight_design_quadratic2, <span class="at">yaxis_max =</span> <span class="dv">1</span>, <span class="at">description =</span> <span class="st">"Fraction of Design Space - D-optimal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_quadratic2, <span class="st">"I"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          I
1 0.1747125</code></pre>
</div>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_fds</span>(flight_design_prediction, <span class="at">yaxis_max =</span> <span class="dv">1</span>, <span class="at">description =</span> <span class="st">"Fraction of Design Space - I-optimal"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-9-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_prediction, <span class="st">"I"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>          I
1 0.1515717</code></pre>
</div>
</div>
<p>We see that the I-optimal design has a lower overall average prediction variance across most of the space, but also has areas with much higher prediction variance. Depending on your experimental goals, you might value one property or the other.</p>
</section>
<section id="split-plot-designs" class="level1">
<h1>Split-plot designs</h1>
<p>See slides.</p>
<p>We also have included a hard-to-change factor <code>Target Environment</code> in our candidate set. We can construct a split-plot design in layers: first by building a design for the hard-to-change factors, fixing those blocks, and then building a design for just the easy-to-change factors.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-10_7af044a19c40090eccc1695a83fab4b7">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>flight_design_htc <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> target_env,</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">8</span>) </span>
<span id="cb34-5"><a href="#cb34-5" aria-hidden="true" tabindex="-1"></a>flight_design_htc</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  target_env
1      urban
2     desert
3      urban
4      urban
5     desert
6      urban
7     desert
8     desert</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>flight_design_splitplot <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode <span class="sc">+</span> target_env)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">splitplotdesign =</span> flight_design_htc,</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">64</span>,</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">parallel =</span> <span class="cn">TRUE</span>, <span class="at">add_blocking_columns =</span> <span class="cn">TRUE</span>) </span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>flight_design_splitplot</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Block1 target_env altitude speed      mode
1.1      1      urban    28000   460     strip
1.2      1      urban    19000   500      scan
1.3      1      urban    10000   470     strip
1.4      1      urban    28000   460 spotlight
1.5      1      urban    20000   550 spotlight
1.6      1      urban    10000   470 spotlight
1.7      1      urban    14000   550     strip
1.8      1      urban    16000   450      scan
2.1      2     desert    14000   550     strip
2.2      2     desert    24000   510      scan
2.3      2     desert    28000   460 spotlight
2.4      2     desert    10000   470 spotlight
2.5      2     desert    19000   450     strip
2.6      2     desert    10000   470      scan
2.7      2     desert    28000   460     strip
2.8      2     desert    20000   550 spotlight
3.1      3      urban    10000   470     strip
3.2      3      urban    14000   550 spotlight
3.3      3      urban    20000   550      scan
3.4      3      urban    28000   460 spotlight
3.5      3      urban    24000   510     strip
3.6      3      urban    10000   470      scan
3.7      3      urban    19000   450 spotlight
3.8      3      urban    28000   460      scan
4.1      4      urban    19000   450     strip
4.2      4      urban    20000   550      scan
4.3      4      urban    10000   470 spotlight
4.4      4      urban    14000   550 spotlight
4.5      4      urban    14000   550     strip
4.6      4      urban    10000   470      scan
4.7      4      urban    28000   460      scan
4.8      4      urban    24000   510 spotlight
5.1      5     desert    14000   550 spotlight
5.2      5     desert    28000   460 spotlight
5.3      5     desert    10000   470 spotlight
5.4      5     desert    24000   510     strip
5.5      5     desert    20000   550      scan
5.6      5     desert    10000   470     strip
5.7      5     desert    18000   450      scan
5.8      5     desert    12000   515     strip
6.1      6      urban    28000   460     strip
6.2      6      urban    14000   550      scan
6.3      6      urban    28000   460      scan
6.4      6      urban    20000   550     strip
6.5      6      urban    20000   550 spotlight
6.6      6      urban    16000   450 spotlight
6.7      6      urban    10000   470     strip
6.8      6      urban    12000   515      scan
7.1      7     desert    28000   460      scan
7.2      7     desert    16000   450     strip
7.3      7     desert    20000   550     strip
7.4      7     desert    10000   470      scan
7.5      7     desert    28000   460 spotlight
7.6      7     desert    14000   550      scan
7.7      7     desert    19000   500 spotlight
7.8      7     desert    12000   515 spotlight
8.1      8     desert    16000   450 spotlight
8.2      8     desert    10000   470     strip
8.3      8     desert    20000   550     strip
8.4      8     desert    28000   460      scan
8.5      8     desert    14000   550      scan
8.6      8     desert    20000   550 spotlight
8.7      8     desert    28000   460     strip
8.8      8     desert    18000   495      scan</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_splitplot) <span class="sc">+</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(target_env<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-10-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The blocking information is by default stored in the row names, but you can turn <code>add_blocking_columns = TRUE</code> and blocking columns will be added to the design. skpr knows to look for these and will handle them separately from factor terms.</p>
<p>You can repeat this process any number of times for nested split-plot designs where you have various blocking levels that have different levels (e.g.&nbsp;split-split plot, split-split-split plot, etc). We can also manually specify the split-plot sizes for each whole plot: if you have a test constraint where you know that some split plot levels are going to have more runs that others, you can account for that here.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-11_44a533302a96def1877c50cf6e1e604f">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>flight_design_splitplot_unbalanced <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode <span class="sc">+</span> target_env)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">splitplotdesign =</span> flight_design_htc,</span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">64</span>, <span class="at">blocksizes =</span> <span class="fu">c</span>(<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">12</span>,<span class="dv">4</span>,<span class="dv">4</span>,<span class="dv">12</span>,<span class="dv">12</span>),</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">parallel =</span> <span class="cn">TRUE</span>, <span class="at">add_blocking_columns =</span> <span class="cn">TRUE</span>) </span>
<span id="cb39-6"><a href="#cb39-6" aria-hidden="true" tabindex="-1"></a>flight_design_splitplot_unbalanced</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     Block1 target_env altitude speed      mode
1.1       1      urban    18000   495      scan
1.2       1      urban    28000   460     strip
1.3       1      urban    14000   550     strip
1.4       1      urban    10000   470 spotlight
2.1       2     desert    20000   550     strip
2.2       2     desert    12000   515 spotlight
2.3       2     desert    16000   450      scan
2.4       2     desert    28000   460 spotlight
3.1       3      urban    28000   460      scan
3.2       3      urban    19000   495     strip
3.3       3      urban    14000   550 spotlight
3.4       3      urban    10000   470     strip
3.5       3      urban    28000   460 spotlight
3.6       3      urban    20000   550     strip
3.7       3      urban    16000   450      scan
3.8       3      urban    14000   550      scan
3.9       3      urban    28000   460     strip
3.10      3      urban    20000   550      scan
3.11      3      urban    10000   470 spotlight
3.12      3      urban    24000   510 spotlight
4.1       4      urban    10000   470      scan
4.2       4      urban    14000   550 spotlight
4.3       4      urban    28000   460      scan
4.4       4      urban    20000   550     strip
4.5       4      urban    28000   460 spotlight
4.6       4      urban    10000   470      scan
4.7       4      urban    16000   450     strip
4.8       4      urban    10000   470     strip
4.9       4      urban    19000   500 spotlight
4.10      4      urban    28000   460     strip
4.11      4      urban    18000   450 spotlight
4.12      4      urban    20000   550      scan
5.1       5     desert    28000   460      scan
5.2       5     desert    24000   510     strip
5.3       5     desert    16000   450     strip
5.4       5     desert    14000   550      scan
6.1       6      urban    28000   460      scan
6.2       6      urban    20000   550 spotlight
6.3       6      urban    16000   450 spotlight
6.4       6      urban    12000   515     strip
7.1       7     desert    19000   450     strip
7.2       7     desert    28000   460 spotlight
7.3       7     desert    20000   550 spotlight
7.4       7     desert    28000   460     strip
7.5       7     desert    19000   450      scan
7.6       7     desert    10000   470     strip
7.7       7     desert    10000   470 spotlight
7.8       7     desert    20000   550      scan
7.9       7     desert    14000   550     strip
7.10      7     desert    24000   510      scan
7.11      7     desert    12000   515 spotlight
7.12      7     desert    10000   470      scan
8.1       8     desert    28000   460     strip
8.2       8     desert    28000   460      scan
8.3       8     desert    10000   470     strip
8.4       8     desert    18000   450 spotlight
8.5       8     desert    14000   550      scan
8.6       8     desert    20000   550 spotlight
8.7       8     desert    14000   550     strip
8.8       8     desert    10000   470      scan
8.9       8     desert    24000   510      scan
8.10      8     desert    20000   550 spotlight
8.11      8     desert    10000   470 spotlight
8.12      8     desert    28000   460 spotlight</code></pre>
</div>
</div>
</section>
<section id="design-augmentation" class="level1">
<h1>Design augmentation</h1>
<p>In addition to split-plot designs, there are other occasions you might run into blocked designs. One of these occasions is when you’re using an iterative testing strategy referred to as sequential experimental design, which is an useful tool when designing resource-constrained experiments.</p>
<p>Sequential design refers to running a much smaller (and thus, less resource- intensive) screening design to test for the existence of effects before committing to a more expensive experiment to characterize their size. After running a screening experiment and detecting that some effects are active, a practitioner needs to design a follow-up experiment to actually characterize the active effects. Generating an entire new optimal design ignores the information already collected in the prior experiment, potentially wasting testing resources that can be targeted at characterizing the effects of interest.</p>
<p>skpr’s Alias-optimality criteria can generate optimal screening designs. Let’s see how it does.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-12_7c06494c9f9bb7a9c0aaded682ffaaa9">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>flight_design_screening <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> altitude <span class="sc">+</span> speed <span class="sc">+</span> mode,</span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">12</span>, <span class="at">optimality =</span> <span class="st">"alias"</span>, <span class="at">minDopt =</span> <span class="dv">0</span>, <span class="at">repeats =</span> <span class="dv">100</span>,</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>                           <span class="at">parallel =</span> <span class="cn">TRUE</span>) </span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a>flight_design_d <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>                           <span class="at">model =</span> <span class="sc">~</span> altitude <span class="sc">+</span> speed <span class="sc">+</span> mode,</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>                           <span class="at">trials =</span> <span class="dv">12</span>, <span class="at">optimality =</span> <span class="st">"D"</span>, <span class="at">repeats=</span><span class="dv">100</span>) </span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_screening) <span class="sc">+</span></span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb41-14"><a href="#cb41-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb41-15"><a href="#cb41-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(flight_design_d) <span class="sc">+</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-12-2.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparing optimality values</span></span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         D         I        A            G        T        E    Alias
1 83.36936 0.3515361 78.41141 Not Computed 52.64198 5.532092 4.767266</code></pre>
</div>
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="fu">get_optimality</span>(flight_design_screening)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         D         I        A            G        T        E    Alias
1 67.50859 0.4056887 58.13202 Not Computed 45.42741 3.294533 4.008502</code></pre>
</div>
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Comparing correlation structure</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_correlations</span>(flight_design_d)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-12-3.png" class="img-fluid" width="672"></p>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_correlations</span>(flight_design_screening)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-12-4.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Now that we have our screening design–let’s augment it. Let’s say we ran our experiment and found that <code>speed:mode</code> and <code>altitude:speed</code> aren’t significant. We can then remove that term from the design and generate a new design that only consists of the terms we have found to be active.</p>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-13_9e11817a5ea5626ffedec0a9c01ceadc">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gen_design</span>(constrained_candidate_set, </span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>           <span class="at">model =</span> <span class="sc">~</span>altitude <span class="sc">+</span> speed <span class="sc">+</span> mode <span class="sc">+</span> altitude<span class="sc">:</span>mode,</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">augmentdesign =</span> flight_design_screening,</span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>           <span class="at">trials =</span> <span class="dv">24</span>) <span class="ot">-&gt;</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>  augmented_design</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning in model.matrix.default(model, augmentnormalized, contrasts.arg =
contrastslist): variable 'target_env' is absent, its contrast will be ignored</code></pre>
</div>
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a>augmented_design</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>   Block1 altitude speed      mode
1       1    17000   455      scan
2       1    13000   515      scan
3       1    13000   525 spotlight
4       1    13000   525     strip
5       1    21000   540     strip
6       1    26000   485     strip
7       1    17000   450 spotlight
8       1    26000   485 spotlight
9       1    17000   450     strip
10      1    20000   550      scan
11      1    21000   540 spotlight
12      1    26000   480      scan
13      2    28000   460      scan
14      2    10000   470 spotlight
15      2    10000   470     strip
16      2    10000   470      scan
17      2    28000   460     strip
18      2    28000   460 spotlight
19      2    10000   470      scan
20      2    28000   460      scan
21      2    28000   460 spotlight
22      2    10000   470 spotlight
23      2    10000   470     strip
24      2    28000   460     strip</code></pre>
</div>
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Dark green dots are the new points</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>() <span class="sc">+</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">data=</span>constrained_candidate_set, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">size=</span><span class="fl">0.5</span>) <span class="sc">+</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="at">data=</span>augmented_design, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"darkgreen"</span>) <span class="sc">+</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_count</span>(<span class="at">data=</span>flight_design_screening, <span class="fu">aes</span>(<span class="at">x=</span>speed,<span class="at">y=</span>altitude),<span class="at">color=</span><span class="st">"red"</span>) <span class="sc">+</span></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>mode) <span class="sc">+</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_radius</span>(<span class="at">range =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">5</span>), <span class="at">breaks =</span> (<span class="cf">function</span>(x) <span class="fu">seq</span>(<span class="fu">min</span>(x),<span class="fu">max</span>(x),<span class="at">by=</span><span class="dv">1</span>)))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<p><img src="skpr_gen_design_live_demo_files/figure-html/unnamed-chunk-13-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="statistical-power" class="level1">
<h1>Statistical Power</h1>
<p>One of the most common goals in running an experiment is to study how a response variable is affected by changes in the experimental factors, and whether those changes are statistically significant. This means the primary concern of the experimenter is to make sure their experiment can actually detect these effects if they exist. We judge this primarily based on statistical power: the probability that our experiment will be able to detect an effect if one truly exists. We’ll look into how to calculate that in skpr next.</p>
<p>But first, let’s regenerate and save our D-optimal design to a CSV file. Although we can easy regenerate our design later by setting our random seed and calling <code>gen_design()</code> again, it can also be nice to save it to a file so you can easily share it and load it later.</p>
</section>
<section id="saving-design-to-csv-to-share" class="level1">
<h1>Saving design to CSV to share</h1>
<div class="cell" data-hash="skpr_gen_design_live_demo_cache/html/unnamed-chunk-14_93153bce91c11999ce92b08c9d2aa1c4">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">2023</span>)</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>design_final <span class="ot">=</span> <span class="fu">gen_design</span>(<span class="at">candidateset =</span> constrained_candidate_set,</span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>                          <span class="at">model =</span> <span class="sc">~</span> (altitude <span class="sc">+</span> speed <span class="sc">+</span> mode)<span class="sc">^</span><span class="dv">2</span> <span class="sc">+</span> <span class="fu">I</span>(speed<span class="sc">^</span><span class="dv">2</span>) <span class="sc">+</span> <span class="fu">I</span>(altitude<span class="sc">^</span><span class="dv">2</span>),</span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>                          <span class="at">trials =</span> <span class="dv">72</span>) </span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(design_final, <span class="at">file =</span> <span class="st">"design_final.csv"</span>, <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>